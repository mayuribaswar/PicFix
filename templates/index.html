<!DOCTYPE html>
<html>
<head>
<title>Image Processing Studio</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background: #f4f6f9; }
img { max-width: 100%; border-radius: 10px; border: 1px solid #ddd; }
.card { border-radius: 15px; }
</style>
</head>

<body>

<nav class="navbar navbar-dark bg-dark px-4">
  <a class="navbar-brand" href="/">Image Processing Studio</a>
  <div class="d-flex gap-2">
    <a href="/" class="btn btn-outline-light">Editor</a>
    <a href="/analyze" class="btn btn-outline-light">Analyze Image</a>
    <a href="/about" class="btn btn-outline-light">About</a>
  </div>
</nav>


<div class="container mt-4">

<div class="card p-4 shadow-sm">
<input type="file" id="upload" class="form-control mb-3">
</div>

<div class="row mt-4">
<div class="col-md-6">
<h6>Original Image</h6>
<img id="original">
</div>

<div class="col-md-6">
<h6>Processed Image</h6>
<img id="processed">

<div class="mt-3 d-flex gap-2">
<button class="btn btn-warning" onclick="apply('reset')">Reset</button>
<a href="/download" class="btn btn-success">Download</a>
</div>
</div>
</div>

<div class="card p-4 mt-4 shadow-sm">
<select class="form-select mb-3" onchange="selectAction(this.value)">
<option selected disabled>Choose Operation</option>

<optgroup label="Intensity">
<option value="brightness">Brightness</option>
<option value="contrast">Contrast</option>
<option value="negative">Negative</option>
</optgroup>

<optgroup label="Color Effects">
<option value="grayscale">Grayscale</option>
<option value="binary">Binary</option>
<option value="red">Reddish</option>
<option value="green">Greenish</option>
<option value="blue">Blueish</option>
<option value="sepia">Sepia</option>
</optgroup>

<optgroup label="Transformations">
<option value="flip_h">Flip Horizontal</option>
<option value="flip_v">Flip Vertical</option>
<option value="rotate_90">Rotate 90°</option>
<option value="rotate_180">Rotate 180°</option>
<option value="zoom_in">Zoom In</option>
<option value="zoom_out">Zoom Out</option>
</optgroup>

<optgroup label="Convert Image">
<option value="jpg">Convert to JPG</option>
<option value="png">Convert to PNG</option>
<option value="webp">Convert to WEBP</option>
</optgroup>
</select>

<input type="range" id="slider" class="form-range d-none">
</div>

</div>

<script>
let file = ""

upload.onchange = () => {
  let data = new FormData()
  data.append("image", upload.files[0])

  fetch("/upload", {method:"POST", body:data})
  .then(r=>r.json())
  .then(d=>{
    file = d.image
    original.src = `/static/uploads/${file}`
    processed.src = `/static/output/${file}`
  })
}

function selectAction(action){
  slider.classList.add("d-none")

  if(action === "brightness"){
    slider.min=-100; slider.max=100; slider.value=0
    slider.oninput=()=>apply(action, slider.value)
    slider.classList.remove("d-none")
  }
  else if(action === "contrast"){
    slider.min=0.5; slider.max=2; slider.step=0.1; slider.value=1
    slider.oninput=()=>apply(action, slider.value)
    slider.classList.remove("d-none")
  }
  else{
    apply(action)
  }
}

function apply(action, value=0){
  fetch("/process",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:action, value:value})
  }).then(()=>{
    processed.src = `/static/output/${file}?${Date.now()}`
  })
}
</script>

</body>
</html>
